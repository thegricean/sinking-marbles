var literalListener = cache(function(utterance, priorParams) {
    Enumerate(function(){
              var primary = flip(priorParams["mix"])
              var prior =  primary ? 
                           binomialMarbles(priorParams["theta1"]) :
                           binomialMarbles(priorParams["theta2"])                                                                        
              var world = discrete(prior)
              var m = meaning(utterance, world)
              condition(m)
              return world
  })
})

var speaker = cache(function(world, priorParams) {
  Enumerate(function(){
            var utterance = utterancePrior()
            var L = literalListener(utterance, priorParams)
            factor(L.score([],world))
            return utterance
            })
})

var regularRSA= function(utterance,speakerOptimality, priorParams) {
        Enumerate(function(){
                  var primary = flip(priorParams["mix"])
                  var prior =  primary ? 
                               binomialMarbles(priorParams["theta1"]) :
                               binomialMarbles(priorParams["theta2"])
                  var world = discrete(prior)

                  var S = speaker(world, priorParams)

                  factor(speakerOptimality*S.score([],utterance))

                  var queryStatement = {"world":world,
                                        "wonky":1-primary}
                  return queryStatement
      })
}

