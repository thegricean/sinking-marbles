var literalListener = cache(function(utterance, priorParams) {
    Enumerate(function(){
              var primary = flip(priorParams["mix"])
              var prior =  primary ? 
                           binomialMarbles(priorParams["theta1"]) :
                           binomialMarbles(priorParams["theta2"])                                                                        
              var world = discrete(prior)
              var m = meaning(utterance, world)
              condition(m)
              return world
  })
})

var speaker = cache(function(world, priorParams) {
  Enumerate(function(){
            var utterance = utterancePrior()
            var L = literalListener(utterance, priorParams)
            factor(L.score([],world))
            return utterance
            })
})

var regularListener = function(utterance,speakerOptimality, priorParams) {
        Enumerate(function(){
                  var primary = flip(priorParams["mix"])
                  var prior =  primary ? 
                               binomialMarbles(priorParams["theta1"]) :
                               binomialMarbles(priorParams["theta2"])
               var world = discrete(prior)
          
                var S = (utterance=='mu') ? 0 : speaker(world, priorParams)

                var scr = (utterance!='mu')  ? 
                      speakerOptimality*S.score([],utterance) : 
                        0

                factor(scr)

                  var queryStatement = {"world":world,
                                        "wonky":1-primary}
                  return queryStatement
      })
}

