---
title: "Prior in the sky (prits)"
author: "mht"
date: "April 4, 2015"
output: html_document
---

```{r}
library(rstan)
setwd("~/Documents/research/sinking-marbles/bayesian_data_analysis/")
dir()


model <- "
// Give a number task
data { 
  int<lower=1> subjects;
  int<lower=1> states;
  int<lower=1> items;
  matrix[items,subjects] ntdata;
}
parameters {
  matrix<lower=0,upper=1>[items,state] prits; 
  vector<lower=0>[subjects] alpha;
}
transformed parameters {
  array[subjects, items, states] exp_prits;
// make this into array of arrays somehow

  for (i in 1:subjects)
    for (j in 1:items)
      for (k in 1:states)
        exp_prits[j,k] <- pow(prits[j,k],alpha[i])
}
model {

  // Priors
  for (i in 1:items)
    for (j in 1:states)
      prits[i,j] ~ beta(1,1)

  for (k in 1:subjects)
      alpha[k] ~ exponential(1)

  for (i in 1:subjects)
    for (j in 1:items)
      ntdata[i,j] ~ multinomial(exp_prits[j,1:states])
  
}"



allpriors<-read.csv(file="inferpriorinsky_number.txt", sep='\t')
d<-matrix(select(allpriors,-workerid))


k <- c(21, 17, 21, 18, 22, 31, 31, 34, 34, 35, 35, 36, 39, 36, 35)
subjects <- length(k)  # number of subjects
items <- 90  # number of items
states <- 16 # number of states

data <- list(p=p, k=k, n=n) # to be passed on to Stan

myinits <- list(
  list(phi=.75))
  
parameters <- c("phi", "z")  # parameters to be monitored
```







